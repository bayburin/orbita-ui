<div [formGroup]="sourceSnapshotForm" class="step-content">
  <div class="step-content-block">
    <mat-form-field class="step-form-group">
      <mat-label>Поиск работника</mat-label>
      <input matInput name="searchEmployee" placeholder="ФИО, табельный номер или номер телефона" [formControl]="searchEmployee"
        [matAutocomplete]="autoEmployee" [errorStateMatcher]="dynamicErrorMatcher">
      <mat-hint align="end">
        <div>Для телефона номер в виде XX-XX</div>
        <div>Для ФИО минимум 3 символа</div>
      </mat-hint>
      <mat-error *ngIf="searchEmployee.hasError('serverError')">Ошибка поиска. Введите данные вручную.</mat-error>
      <button *ngIf="searchEmployee.value" mat-icon-button matSuffix (click)="clearSearchEmployee()" [disabled]="isManually.value">
        <mat-icon svgIcon="close"></mat-icon>
      </button>
      <mat-autocomplete #autoEmployee="matAutocomplete" [displayWith]="displayEmployeeFn" [autoActiveFirstOption]="true"
        (optionSelected)="selectEmployee($event.option.value)">
        <mat-optgroup *ngFor="let group of employeeGroups$ | async">
          отдел {{ group.dept }}
          <mat-option *ngFor="let employee of group.employees" [value]="employee">{{ employee.fullName }}</mat-option>
        </mat-optgroup>
      </mat-autocomplete>
    </mat-form-field>
    <mat-slide-toggle [formControl]="isManually">Ввести данные о пользователе вручную</mat-slide-toggle>
  </div>

  <div class="step-content-block">
    <div *ngIf="isManually.value" class="small-input-block">
      <mat-form-field>
        <mat-label>Табельный номер</mat-label>
        <input matInput name="tn" placeholder="Табельный номер" formControlName="tn" required>
        <mat-error>Не может быть пустым</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>ФИО</mat-label>
        <input matInput name="fio" placeholder="ФИО" formControlName="fio" required>
        <mat-error>Не может быть пустым</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Подразделение</mat-label>
        <input matInput name="dept" placeholder="Подразделение" formControlName="dept" required>
        <mat-error>Не может быть пустым</mat-error>
      </mat-form-field>
    </div>

    <div class="small-input-block">
      <mat-form-field>
        <mat-label>Электронная почта</mat-label>
        <input matInput name="email" placeholder="Электронная почта" formControlName="email">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Рабочий телефон</mat-label>
        <input matInput name="tel" placeholder="Рабочий телефон" formControlName="tel">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Сотовый телефон</mat-label>
        <input type="tel" matInput name="mobile" placeholder="555-555-1234" formControlName="mobile">
      </mat-form-field>
    </div>
  </div>

  <ng-container *ngIf="searchEmployee.value && tn">
    <mat-divider class="step-content-block position-static"></mat-divider>
    <div class="step-content-block employee-card-wrapper ml-auto mr-auto">
      <app-employee-mini-card [employee]="selectedEmployee"></app-employee-mini-card>
    </div>
  </ng-container>
</div>
